# Command Line Build

The `cbuild` utility implements the build flow by chaining the utilities [**cbuildgen**](./cbuildgen), *CMake*, and a
*CMake generator*. It distributed as part of
the [CMSIS-Toolbox](https://github.com/Open-CMSIS-Pack/cmsis-toolbox/blob/main/docs/installation.md).

`cbuild` replicates the steps of pack-aware IDEs with the following build flow:

- Call *cbuildgen* to generate a packlist with URLs of missing software packs. If packs are missing:
  - Call [**cpackget**](../../cpackget) to download and install missing software packs.
- Call *cbuildgen* to generate a CMakeLists.txt file.
- Call [**CMake**](https://cmake.org/documentation/) to compile the project source code into the binary image using the
specified *CMake generator*.

## Usage

The **cbuild** utility uses a `*.cprj` project file that is generated by various tools, for example the
[**csolution**](../../projmgr/docs/Manual/Overview.md) project manager.

```bash
cbuild <project.cprj> [flags]

Flags:
  -c, --clean              Remove intermediate and output directories
  -d, --debug              Enable debug messages
  -g, --generator string   Select build system generator (default "Ninja")
  -h, --help               Print usage
  -i, --intdir string      Set directory for intermediate files
  -j, --jobs int           Number of job slots for parallel execution
  -l, --log string         Save output messages in a log file
  -o, --outdir string      Set directory for output files
  -p, --packs              Download missing software packs with cpackget
  -q, --quiet              Suppress output messages except build invocations
  -r, --rebuild            Remove intermediate and output directories and rebuild
  -s, --schema             Check *.cprj file against CPRJ.xsd schema
  -t, --target string      Optional CMake target name
  -u, --update string      Generate *.cprj file for reproducing current build
  -v, --verbose            Enable verbose messages from toolchain builds
  -V, --version            Print version
```

## Usage Examples

1. *Simple Build:* Translate the application defined by the project file `MyProgram.cprj`:

   ```bash
   cbuild MyProgram.cprj 
   ```

2. *Protocol Output:* Translate using the directory `./IntDir/Debug` to store intermediate files and `./OutDir` for
the final output image along with build information. Store the build output information the file `MyProgram.log`:

   ```bash
   cbuild MyProgram.cprj -i ./IntDir/Debug -o ./OutDir -l MyProgram.log
   ```

3. *Clean Project:* Remove the build output and intermediate files of the previous build command:

   ```bash
   cbuild MyProgram.cprj -i ./IntDir/Debug -o ./OutDir -c
   ```

4. *Quite Mode:* Build the application suppressing detailed output:

   ```bash
   cbuild MyProgram.cprj -q
   ```

5. *Restrict Cores:* Build the application using only two processor cores:

   ```bash
   cbuild MyProgram.cprj -j2
   ```
